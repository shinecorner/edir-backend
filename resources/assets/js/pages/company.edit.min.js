$(document).ready(function() {
    if($('textarea').prop("readonly")) {
        $('textarea').summernote('disable');
    }
    else {
        $('textarea').summernote({height: "300px"});
    }

    $('.date, .date input').daterangepicker({
        "singleDatePicker": true,
        "autoUpdateInput": true,
        "autoApply": true,
        "locale": {
            "format": "DD.MM.YYYY",
        }
    });

    $('#opening-times input').clockpicker({
        autoclose: true,
        donetext: 'Fertig',
        'default': 'now'
    });

    $('select[name="category_secondary_ids[]"]').select2({
        placeholder: 'Bitte wählen Sie eine Unterkategorie',
        multiple: true,
        maximumSelectionLength: $('input[name="num_categories"]').val(),
        minimumInputLength: 3,
        language: "de",
        allowClear: true,
        ajax: {
            url: '/unterkategorie-suche',
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return {
                    term: params.term
                };
            },
            processResults: function (json)
            {
                var myResults = [];
                $.each(json, function () {
                    var children = [];
                    $.each(this.subcategories, function () {
                        children.push( {
                            id: this.id,
                            text: this.name
                        })
                    });
                    myResults.push(
                        {
                            id: this.id,
                            text: this.name,
                            children: children
                        }
                    );
                });

                return {
                    results: myResults
                };
            }
        }
    });

    $.each($('.categorySecondaryOldValues'), function() {
        $('select[name="category_secondary_ids[]"]').append('<option value="'+$(this).data().id+'" selected="selected">'+$(this).data().name+'</option>')
    });

    $('select[name="keywords[]"]').select2({
        tags: true,
        multiple: true,
        maximumSelectionLength: 5,
        tokenSeparators: [","],
        language: "de"
    });

    $('#user_id').select2({
        placeholder: 'Bitte wählen Sie einen Benutzer',
        minimumInputLength: 2,
        maximumSelectionLength: 1,
        allowClear: true,
        language: "de",
        ajax: {
            url: '/kunden-suche',
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return {
                    term: params.term
                };
            },
            processResults: function (json)
            {
                var myResults = [];
                $.each(json, function (name, id) {
                    myResults.push({
                        id: id,
                        text: name
                    });
                });
                return {
                    results: myResults
                };
            }
        }
    });

    var userOldValue = $('#userOldValue').data();
    if(userOldValue.id) {
        $('#user_id').append('<option value="'+userOldValue.id+'" selected="selected">'+userOldValue.name+'</option>');
        $('#user_id').trigger('change');
    }

});